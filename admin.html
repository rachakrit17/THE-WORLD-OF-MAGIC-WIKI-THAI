
<!doctype html><html lang="th"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô ‚Äî THE‚ÄëWORLD‚ÄëOF‚ÄëMAGIC‚ÄëWIKI‚ÄëTHAI</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="assets/css/styles.css">
</head>
<body class="bg-dark text-light">
<div id="topnav"></div>
<main class="container-fluid my-3">
  <!-- Login Gate -->
  <section id="loginGate" class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      <div class="neon p-4 text-center rounded-2xl">
        <h1 class="h4 mb-2">üõ°Ô∏è ‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô</h1>
        <p class="opacity-70 mb-3">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Google ‡∏Å‡πà‡∏≠‡∏ô ‡∏à‡∏∂‡∏á‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏î‡πâ</p>
        <button id="btnGoogle" class="btn btn-neon btn-lg">üîë Sign in with Google</button>
        <div id="loginError" class="small text-danger mt-3 d-none"></div>
      </div>
    </div>
  </section>

  <!-- Admin Panel -->
  <section id="adminPanel" class="d-none">
    <div class="admin-shell">
      <aside class="admin-left neon rounded-2xl">
        <div class="d-flex align-items-center justify-content-between mb-2">
          <strong>‡πÄ‡∏°‡∏ô‡∏π‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</strong>
          <button id="btnSignout" class="btn btn-sm btn-outline-light">‡∏≠‡∏≠‡∏Å</button>
        </div>
        <div id="adminMenu" class="list-group"></div>
        <div id="statsBox" class="neon p-2 mt-3 rounded-2xl"></div>
      </aside>

      <section class="admin-main">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <div>
            <h1 class="h4 mb-1">üõ†Ô∏è ‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô <span class="badge badge-soft ms-2">Deluxe</span></h1>
            <div class="small hint">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏ã‡πâ‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‚Ä¢ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö URL</div>
          </div>
          <div class="d-flex align-items-center gap-2">
            <div class="badge bg-success d-none" id="roleBadge">admin</div>
          </div>
        </div>

        <div class="card neon rounded-2xl">
          <div class="card-body">
            <h2 id="adminTitle" class="h5 mb-3">Guides</h2>
            <form id="adminForm" class="row g-3"></form>
            <div class="d-flex flex-wrap gap-2 mt-2">
              <button class="btn btn-neon" id="btnSave">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (Draft) üíæ</button>
              <button class="btn btn-success" id="btnPublish" type="button">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å & ‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà üöÄ</button>
              <button class="btn btn-secondary" id="btnNew" type="button">‡πÉ‡∏´‡∏°‡πà üÜï</button>
              <button class="btn btn-danger" id="btnDelete" type="button">‡∏•‡∏ö üóëÔ∏è</button>
            </div>
            <hr>
            <div class="table-responsive">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <div class="input-group w-auto">
                  <span class="input-group-text">üîé</span>
                  <input id="gridSearch" class="form-control" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á">
                </div>
                <span class="small opacity-70" id="gridCount"></span>
              </div>
              <table class="table table-dark table-striped align-middle">
                <thead id="gridHead"></thead>
                <tbody id="gridBody"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>
    </div>
  </section>
</main>
<div id="footer"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/i18next@23.11.5/dist/umd/i18next.min.js"></script>
<script src="assets/js/i18n.js"></script>
<script src="assets/js/firebase-init.js"></script>
<script src="assets/js/auth.js"></script>
<script src="assets/js/fx.js"></script>
<script src="assets/js/app.js"></script>
<script src="assets/js/admin.js"></script>
<script>
  window.renderShell && window.renderShell();
  // Gate
  const loginGate = document.getElementById('loginGate');
  const adminPanel = document.getElementById('adminPanel');
  const roleBadge = document.getElementById('roleBadge');
  const loginError = document.getElementById('loginError');
  function showLogin(msg){ loginGate.classList.remove('d-none'); adminPanel.classList.add('d-none'); if(msg){ loginError.textContent = msg; loginError.classList.remove('d-none'); } }
  function showAdmin(){ loginGate.classList.add('d-none'); adminPanel.classList.remove('d-none'); roleBadge.classList.remove('d-none'); if(window.initAdminUI){ window.initAdminUI(); } }
  document.getElementById('btnGoogle').addEventListener('click', async ()=>{
    const provider = new firebase.auth.GoogleAuthProvider();
    try{ await auth.signInWithPopup(provider); }catch(err){
      if(['auth/popup-blocked','auth/operation-not-supported-in-this-environment','auth/cancelled-popup-request'].includes(err?.code)){
        try{ await auth.signInWithRedirect(provider); }catch(e2){ showLogin(e2.message || 'Sign-in failed'); }
      }else{ showLogin(err.message || 'Sign-in failed'); }
    }
  });
  document.getElementById('btnSignout').addEventListener('click', async ()=>{ await auth.signOut(); });
  let initialized=false;
  auth.onAuthStateChanged(async (user)=>{
    if(!user){ showLogin(); return; }
    try{
      const r = await db.collection('roles').doc(user.uid).get();
      if(r.exists && r.data().role === 'admin'){ if(!initialized){ showAdmin(); initialized=true; } }
      else{ showLogin('‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå admin'); }
    }catch(e){ showLogin('‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); }
  });
</script>
</body></html>
